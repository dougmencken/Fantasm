
RUN_IN_MAC:
	EVEN
***THIS IS THE RUNNER FOR THE MACINTOSH ENVIRONMENT.
***FIRST WE ADJUST ALL LONGS IN CODE TO ACTUAL EXECUTABLE POSITION FROM
***THE RELOC TABLE.
***THIS IS AN EXERCISE FOR ME IN MAKING AN ST EXECUATABLE, ACTUALLY EXECUTABLE!
	LEA KEY_TEXT(PC),A0
	BSR.L PRINTIT 		*PRESS ANY KEY TO START EXECUTION
	BSR.l WAIT_KEY
	LEA EXECUTE_TEXT(PC),A0
	BSR.L PRINTIT
	MOVEA.L CODE_START(A5),A1 	*START OF CODE
	MOVEA.L RELOC_TAB(A5),A0 	*LIST OF LONGS NEEDING RELOCATION (AT NO EXPENSE!)
	MOVE.L RELOC_TAB_POS(A5),D0 	*HOW MANY
	BEQ.S RUNNIT 		*NO LONGS TO RELOC
	LSR.L #2,D0 		*DIVIDE BY 4
	MOVE.L A1,D1 		*D1 IS BASE OFFSET
	SUBQ.L #1,D0 		*COUNT
ADD_OFF:
	MOVE.L (A0)+,D2 	*GET ADDRESS OF LONG
 ADD.L D1,0(A1,D2.L) 	*ADD BASE OFFSET
 DBF D0,ADD_OFF
 
RUNNIT:
	MOVEM.L	A5-A6,-(SP)
	MOVEA.L	CODE_START(A5),A2
	JSR	(A2)		RUN IT
restart:	
	MOVEM.L	(SP)+,A5-A6
 RTS
 dc.b	"restart "
 even
**************************************************************************************
key_text:	DC.B	"Press any key to begin execution.",13,13,0
execute_text:	DC.B	"Running......",13,13,0
	EVEN
	GLOBAL	RUN_IN_MAC
	EXTERN	PRINTIT,WAIT_KEY	